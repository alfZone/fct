<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribuição de Alunos - Escola Esmonserrate</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: 'Roboto', sans-serif; background:#f5f7fa; margin:0; }
header, footer { background:#004080; color:#fff; text-align:center; padding:15px 0; }
header img { height:60px; margin-bottom:10px; }
main { max-width:900px; margin:30px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
h1 { text-align:center; color:#004080; margin-bottom:20px; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; }
th, td { border:1px solid #ddd; padding:10px; text-align:left; }
th { background-color:#004080; color:#fff; }
select { width:100%; padding:5px; border-radius:5px; border:1px solid #ccc; }
.buttons-container { display:flex; justify-content:space-between; gap:4%; }
.btn { padding:12px 25px; font-size:1rem; color:#fff; border:none; border-radius:8px; cursor:pointer; transition:0.3s; width:48%; }
.btn-distribuir { background-color:#0073e6; }
.btn-distribuir:hover { background-color:#005bb5; }
.btn-voltar { background-color:#555; }
.btn-voltar:hover { background-color:#333; }
</style>
</head>
<body>

<header>
<img src="..//templates/base/imagens/esm_174.png" alt="Logo Escola Esmonserrate">
<p>Professora: Maria Silva</p>
<p>Bem-vindo(a)!</p>
</header>

<main>
<h1>Distribuição de Alunos por Empresas</h1>

<form action="processarDistribuicao.php" method="post">
<table class="table table-striped">
<thead>
<tr>
<th>Aluno</th>
<th>Empresa</th>
</tr>
</thead>
<tbody id="tabelaAlunos">
<tr><td colspan="2">Carregando alunos...</td></tr>
</tbody>
</table>

<div class="buttons-container">
<button type="submit" class="btn btn-distribuir">Distribuir Selecionados</button>
<button type="button" class="btn btn-voltar" onclick="location.href='index.html'">Voltar</button>
</div>
</form>
</main>

<footer>
&copy; 2025 Escola Esmonserrate. Todos os direitos reservados.
</footer>

<script>
let alunos = [];
let empresas = [];

// Buscar dados do backend
Promise.all([
fetch('endpointAlunos.php').then(r => r.json()),
fetch('endpointEmpresas.php').then(r => r.json())
]).then(([a, e]) => {
alunos = a;
empresas = e;

const tbody = document.getElementById('tabelaAlunos');
tbody.innerHTML = ''; // limpa "Carregando alunos..."

if(alunos.length === 0) {
  tbody.innerHTML = '<tr><td colspan="2">Nenhum aluno encontrado</td></tr>';
  return;
}
if(empresas.length === 0) {
  tbody.innerHTML = '<tr><td colspan="2">Nenhuma empresa encontrada</td></tr>';
  return;
}

// Preenche a tabela
alunos.forEach(aluno => {
  const tr = document.createElement('tr');
  const tdAluno = document.createElement('td');
  tdAluno.textContent = aluno.nome;

  const tdEmpresa = document.createElement('td');
  const select = document.createElement('select');
  select.name = `empresa[${aluno.id}]`;
  const optionDefault = document.createElement('option');
  optionDefault.value = '';
  optionDefault.textContent = 'Selecione a empresa';
  select.appendChild(optionDefault);

  empresas.forEach(emp => {
    const opt = document.createElement('option');
    opt.value = emp.id;
    opt.textContent = emp.nome;
    select.appendChild(opt);
  });

  tdEmpresa.appendChild(select);
  tr.appendChild(tdAluno);
  tr.appendChild(tdEmpresa);
  tbody.appendChild(tr);
});

}).catch(err => {
  console.error('Erro ao carregar dados:', err);
  document.getElementById('tabelaAlunos').innerHTML = '<tr><td colspan="2">Erro ao carregar dados</td></tr>';
});
</script>

</body>
</html>

